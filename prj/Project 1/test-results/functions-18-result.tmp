(TEST 18) cmdcol_update_state_2
COMMENTS:

program: ./test_cmd cmdcol_update_state_2
Failure messages:
- FAILURE(13): Valgrind detected errors
- FAILURE: Output Mismatch at lines marked

--- Side by Side Differences ---
- Expect output in: test-results/raw/functions-18-expect.tmp
- Actual output in: test-results/raw/functions-18-actual.tmp
- Differing lines have a character like '|' '>' or '<' in the middle
==== EXPECT ====                                                  ==== ACTUAL ====                                               
{                                                                 {
    // Adds several commands to a collection, starts those            // Adds several commands to a collection, starts those
    // commands, then blocks for updates on all commands              // commands, then blocks for updates on all commands
    // via cmdcol_update_state(). Should produce alerts               // via cmdcol_update_state(). Should produce alerts
    // that all of the children have finished and there               // that all of the children have finished and there
    // should be alerts for all children.                             // should be alerts for all children.
    char *children[][5] = {                                           char *children[][5] = {
      {"cat","test_data/quote.txt",NULL},                               {"cat","test_data/quote.txt",NULL},    
      {"ls","-a","test_data/stuff",NULL},                               {"ls","-a","test_data/stuff",NULL},
      {"grep","-i", "flurbo ","test_data/gettysburg.txt",NULL},         {"grep","-i", "flurbo ","test_data/gettysburg.txt",NULL},
      {"ls","-a","-F","test_data/stuff",NULL},                          {"ls","-a","-F","test_data/stuff",NULL},
      {"gcc","-o","test_data/print_args",                               {"gcc","-o","test_data/print_args",
                   "test_data/print_args.c",NULL},                                   "test_data/print_args.c",NULL},
      {NULL},                                                           {NULL},
    };                                                                };
    cmdcol_t cmdcol_actual = {};                                      cmdcol_t cmdcol_actual = {};
    cmdcol_t *cmdcol = &cmdcol_actual;                                cmdcol_t *cmdcol = &cmdcol_actual;
    for(int i=0; children[i][0] != NULL; i++){                        for(int i=0; children[i][0] != NULL; i++){
      cmd_t *cmd = cmd_new(children[i]);                                cmd_t *cmd = cmd_new(children[i]);
      cmdcol_add(cmdcol, cmd);                                          cmdcol_add(cmdcol, cmd);
      cmd_start(cmd);                                                   cmd_start(cmd);
    }                                                                 }
    cmdcol_update_state(cmdcol, DOBLOCK);                             cmdcol_update_state(cmdcol, DOBLOCK);
    cmdcol_freeall(cmdcol);                                           cmdcol_freeall(cmdcol);
}                                                                 }
                                                                > cat[%0]: EXIT(0)
                                                                > ls[%1]: EXIT(0)
                                                                > grep[%2]: EXIT(1)
                                                                > ls[%3]: EXIT(0)
                                                                > gcc[%4]: EXIT(0)
ALERTS:                                                           ALERTS:
@!!! cat[%0]: EXIT(0)                                           <
@!!! ls[%1]: EXIT(0)                                            <
@!!! grep[%2]: EXIT(1)                                          <
@!!! ls[%3]: EXIT(0)                                            <
@!!! gcc[%4]: EXIT(0)                                           <
                                                                <
--- Line Differences ---
ACTUAL:  26) cat[%0]: EXIT(0)
ACTUAL:  27) ls[%1]: EXIT(0)
ACTUAL:  28) grep[%2]: EXIT(1)
ACTUAL:  29) ls[%3]: EXIT(0)
ACTUAL:  30) gcc[%4]: EXIT(0)
EXPECT:  27) @!!! cat[%0]: EXIT(0)
EXPECT:  28) @!!! ls[%1]: EXIT(0)
EXPECT:  29) @!!! grep[%2]: EXIT(1)
EXPECT:  30) @!!! ls[%3]: EXIT(0)
EXPECT:  31) @!!! gcc[%4]: EXIT(0)
EXPECT:  32) 

--- Valgrind Log from: test-results/raw/functions-18-valgrd.tmp ---
==20873== Memcheck, a memory error detector
==20873== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==20873== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
==20873== Command: ./test_cmd cmdcol_update_state_2
==20873== Parent PID: 20872
==20873== 
==20876== Syscall param execve(argv) points to uninitialised byte(s)
==20876==    at 0x493D2FB: execve (syscall-template.S:78)
==20876==    by 0x493DCEE: __execvpe_common (execvpe.c:136)
==20876==    by 0x493DCEE: execvpe (execvpe.c:190)
==20876==    by 0x10B4CE: cmd_start (cmd.c:85)
==20876==    by 0x10AD56: main (test_cmd.c:435)
==20876==  Address 0x4a4c150 is 272 bytes inside a block of size 2,352 alloc'd
==20876==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20876==    by 0x10B23B: cmd_new (cmd.c:25)
==20876==    by 0x10AD27: main (test_cmd.c:433)
==20876==  Uninitialised value was created by a heap allocation
==20876==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20876==    by 0x10B23B: cmd_new (cmd.c:25)
==20876==    by 0x10AD27: main (test_cmd.c:433)
==20876== 
==20877== Syscall param execve(argv) points to uninitialised byte(s)
==20877==    at 0x493D2FB: execve (syscall-template.S:78)
==20877==    by 0x493DCEE: __execvpe_common (execvpe.c:136)
==20877==    by 0x493DCEE: execvpe (execvpe.c:190)
==20877==    by 0x10B4CE: cmd_start (cmd.c:85)
==20877==    by 0x10AD56: main (test_cmd.c:435)
==20877==  Address 0x4a4cd48 is 280 bytes inside a block of size 2,352 alloc'd
==20877==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20877==    by 0x10B23B: cmd_new (cmd.c:25)
==20877==    by 0x10AD27: main (test_cmd.c:433)
==20877==  Uninitialised value was created by a heap allocation
==20877==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20877==    by 0x10B23B: cmd_new (cmd.c:25)
==20877==    by 0x10AD27: main (test_cmd.c:433)
==20877== 
==20878== Syscall param execve(argv) points to uninitialised byte(s)
==20878==    at 0x493D2FB: execve (syscall-template.S:78)
==20878==    by 0x493DCEE: __execvpe_common (execvpe.c:136)
==20878==    by 0x493DCEE: execvpe (execvpe.c:190)
==20878==    by 0x10B4CE: cmd_start (cmd.c:85)
==20878==    by 0x10AD56: main (test_cmd.c:435)
==20878==  Address 0x4a4da80 is 288 bytes inside a block of size 2,352 alloc'd
==20878==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20878==    by 0x10B23B: cmd_new (cmd.c:25)
==20878==    by 0x10AD27: main (test_cmd.c:433)
==20878==  Uninitialised value was created by a heap allocation
==20878==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20878==    by 0x10B23B: cmd_new (cmd.c:25)
==20878==    by 0x10AD27: main (test_cmd.c:433)
==20878== 
==20879== Syscall param execve(argv) points to uninitialised byte(s)
==20879==    at 0x493D2FB: execve (syscall-template.S:78)
==20879==    by 0x493DCEE: __execvpe_common (execvpe.c:136)
==20879==    by 0x493DCEE: execvpe (execvpe.c:190)
==20879==    by 0x10B4CE: cmd_start (cmd.c:85)
==20879==    by 0x10AD56: main (test_cmd.c:435)
==20879==  Address 0x4a4e8f0 is 288 bytes inside a block of size 2,352 alloc'd
==20879==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20879==    by 0x10B23B: cmd_new (cmd.c:25)
==20879==    by 0x10AD27: main (test_cmd.c:433)
==20879==  Uninitialised value was created by a heap allocation
==20879==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20879==    by 0x10B23B: cmd_new (cmd.c:25)
==20879==    by 0x10AD27: main (test_cmd.c:433)
==20879== 
==20880== Syscall param execve(argv) points to uninitialised byte(s)
==20880==    at 0x493D2FB: execve (syscall-template.S:78)
==20880==    by 0x493DCEE: __execvpe_common (execvpe.c:136)
==20880==    by 0x493DCEE: execvpe (execvpe.c:190)
==20880==    by 0x10B4CE: cmd_start (cmd.c:85)
==20880==    by 0x10AD56: main (test_cmd.c:435)
==20880==  Address 0x4a4f760 is 288 bytes inside a block of size 2,352 alloc'd
==20880==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20880==    by 0x10B23B: cmd_new (cmd.c:25)
==20880==    by 0x10AD27: main (test_cmd.c:433)
==20880==  Uninitialised value was created by a heap allocation
==20880==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20880==    by 0x10B23B: cmd_new (cmd.c:25)
==20880==    by 0x10AD27: main (test_cmd.c:433)
==20880== 
==20873== 
==20873== HEAP SUMMARY:
==20873==     in use at exit: 4,340 bytes in 22 blocks
==20873==   total heap usage: 27 allocs, 5 frees, 16,100 bytes allocated
==20873== 
==20873== 5 bytes in 5 blocks are definitely lost in loss record 1 of 2
==20873==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20873==    by 0x10B645: read_all (cmd.c:140)
==20873==    by 0x10B727: cmd_fetch_output (cmd.c:174)
==20873==    by 0x10B5CD: cmd_update_state (cmd.c:119)
==20873==    by 0x10B9C0: cmdcol_update_state (cmdcol.c:67)
==20873==    by 0x10AD9D: main (test_cmd.c:437)
==20873== 
==20873== 4,335 bytes in 17 blocks are definitely lost in loss record 2 of 2
==20873==    at 0x483B7F3: malloc (in /usr/lib/x86_64-linux-gnu/valgrind/vgpreload_memcheck-amd64-linux.so)
==20873==    by 0x10B268: cmd_new (cmd.c:29)
==20873==    by 0x10AD27: main (test_cmd.c:433)
==20873== 
==20873== LEAK SUMMARY:
==20873==    definitely lost: 4,340 bytes in 22 blocks
==20873==    indirectly lost: 0 bytes in 0 blocks
==20873==      possibly lost: 0 bytes in 0 blocks
==20873==    still reachable: 0 bytes in 0 blocks
==20873==         suppressed: 0 bytes in 0 blocks
==20873== 
==20873== For lists of detected and suppressed errors, rerun with: -s
==20873== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 0 from 0)

